---
title: "main"
output: html_document
date: "2023-04-16"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Load Data
```{r}
data_dir <- "../data/"
listing <- read.csv(paste0(data_dir,"listings.csv"))
listing2 <- read.csv(paste0(data_dir, "listings 2.csv"))
neighbourhoods <- read.csv(paste0(data_dir, "neighbourhoods.csv"))
reviews <- read.csv(paste0(data_dir, "reviews.csv"))
reviews2 <- read.csv(paste0(data_dir, "reviews 2.csv"))
```
Our data covers the quarterly data from last year.

# Data Preparation
``` {r}
# Select relevant features
listing_col <- c("id", "neighbourhood_group", "neighbourhood", "latitude", "longitude", "room_type", "price")
listing2_col <- c("id", "property_type", "accommodates", "bedrooms", "beds", "amenities", "review_scores_rating",
                  "review_scores_accuracy", "review_scores_cleanliness", "review_scores_checkin", "review_scores_communication", 
                  "review_scores_location", "review_scores_value", "instant_bookable")
listing_sub <- subset(listing, select=listing_col)
listing2_sub <- subset(listing2,select=listing2_col)

# Merge listing and listing2
data <- merge(listing_sub, listing2_sub, by = "id", all.x = TRUE)

# Check for missing values
print("Missing values:")
colSums(is.na(data))
```
There some missing values, especially in the ratings variables. We will use MICE imputation to impute the missing values.
``` {r}
library(mice)

# Select variables with missing values
vars <- c("bedrooms", "beds", "review_scores_rating", "review_scores_accuracy", 
          "review_scores_cleanliness", "review_scores_checkin", "review_scores_communication", 
          "review_scores_location", "review_scores_value")

# Perform MICE imputation
imp <- mice(data[, vars], method = "pmm", m = 5, maxit = 50, seed = 12)


# Replace the missing values in the original dataset with the imputed values
data[, vars] <- complete(imp)

# Check for any remaining missing values
sapply(data, function(x) sum(is.na(x)))

```




